<!DOCTYPE html>
<html lang="en">
<head>
    <title>BTC/USD 5-min Chart with Liquidations</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: sans-serif;
        }
        #chart-container {
            width: 100vw;
            height: 100vh;
            background-color: #1E1E1E;
        }
        #price-label {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #D3D3D3;
            font-size: 1.2em;
            background: rgba(42, 42, 42, 0.8);
            padding: 5px 10px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div id="chart-container"></div>
    <div id="price-label">$0</div>
    <script>
        // Embedded Lightweight Charts v4.1.3 (minified)
        !function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n=e();for(var i in n)("object"==typeof exports?exports:t)[i]=n[i]}}("undefined"!=typeof self?self:this,(function(){return function(){var t={772:function(t,e,n){var i,r,o;t.exports=(i=n(773),r=n(774),o=function(t,e,n,i,r,o,a,s){var l=this;l._chart=t,l._series=e;var c=t.options(),u=e.options();l._renderProxy=h.bind(l),l._priceScale=i,l.visible=function(){return!!u.visible},l.options=function(){return u},l.chart=function(){return c},l.priceScale=function(){return i},l.autoscaleInfo=function(t,e){var n=l._series.autoscaleInfo(t,e);if(null===n)return n;var r=i.defaultPriceScaleOptions().autoScale;return{priceRange:n.priceRange(),margins:r?n.margins():void 0}},l.setData=function(t){e.setData(t)},l.updateBar=function(t,e){n.updateBar(t,e)},l.setMarkers=function(t){e.setMarkers(t)},l.createPriceLine=function(t){return e.createPriceLine(t)},l.removePriceLine=function(t){e.removePriceLine(t)},l.applyOptions=function(t){e.applyOptions(t)},l.barColor=function(){return u.upColor},l.seriesType=function(){return"Candlestick"},l._innerAPI=function(){return e},l._innerWindow=function(){return n},s&&s(l),a&&a(l)},function(t,e,n,i){return new o(t,e,0,0,n,i)})}(),t.exports)},773:function(t,e){t.exports={version:"4.1.3"}},774:function(t,e){t.exports=function(t,e,n,i,r,o){var a,s,l,c,u,h,d,f,p,g,m,v,_,y,b,w,x,S,M,k,C,T,D,z,P,E,F,O,L,I,R,A,B,H,N,W,j,U,V,G,q,Y,K,Q,Z,$,X,J,tt,et,nt,it,rt,ot,at,st,lt,ct,ut,ht,dt,ft,pt,gt,mt,vt,_t,yt,bt,wt,xt,St,Mt,kt,Ct,Tt,Dt,zt,Pt,Et,Ft,Ot,Lt,It,Rt,At,Bt,Ht,Nt,Wt,jt,Ut,Vt,Gt,qt,Yt,Kt,Qt,Zt,$t,Xt,Jt,te,ee,ne,ie,re,oe,ae,se,le,ce,ue,he,de,fe,pe,ge,me,ve,_e,ye,be,we,xe,Se,Me,ke,Ce,Te,De,ze,Pe,Ee,Fe,Oe,Le,Ie,Re,Ae,Be,He,Ne,We,je,Ue,Ve,Ge,qe,Ye,Ke,Qe,Ze,$e,Xe,Je,tn,en,nn,rn,on,an,sn,ln,cn,un,hn,dn,fn,pn,gn,mn,vn,_n,yn,bn,wn,xn,Sn,Mn,kn,Cn,Tn,Dn,zn,Pn,En,Fn,On,Ln,In,Rn,An,Bn,Hn,Nn,Wn,jn,Un,Vn,Gn,qn,Yn,Kn,Qn,Zn,$n,Xn,Jn,ti,ei,ni,ii,ri,oi,ai,si,li,ci,ui,hi,di,fi,pi,gi,mi,vi,_i,yi,bi,wi,xi,Si,Mi,ki,Ci,Ti,Di,zi,Pi,Ei,Fi,Oi,Li,Ii,Ri,Ai,Bi,Hi,Ni,Wi,ji,Ui,Vi,Gi,qi,Yi,Ki,Qi,Zi,$i,Xi,Ji,tr,er,nr,ir,rr,or,ar,sr,lr,cr,ur,hr,dr,fr,pr,gr,mr,vr,_r,yr,br,wr,xr,Sr,Mr,kr,Cr,Tr,Dr,zr,Pr,Er,Fr,Or,Lr,Ir,Rr,Ar,Br,Hr,Nr,Wr,jr,Ur,Vr,Gr,qr,Yr,Kr,Qr,Zr,$r,Xr,Jr,to,eo,no,io,ro,oo,ao,so,lo,co,uo,ho,do,fo,po,go,mo,vo,_o,yo,bo,wo,xo,So,Mo,ko,Co,To,Do,zo,Po,Eo,Fo,Oo,Lo,Io,Ro,Ao,Bo,Ho,No,Wo,jo,Uo,Vo,Go,qo,Yo,Ko,Qo,Zo,$o,Xo,Jo,ta,ea,na,ia,ra,oa,aa,sa,la,ca,ua,ha,da,fa,pa,ga,ma,va,_a,ya,ba,wa,xa,Sa,Ma,ka,Ca,Ta,Da,za,Pa,Ea,Fa,Oa,La,Ia,Ra,Aa,Ba,Ha,Na,Wa,ja,Ua,Va,Ga,qa,Ya,Ka,Qa,Za,$a,Xa,Ja,ts,es,ns,is,rs,os,as,ss,ls,cs,us,hs,ds,fs,ps,gs,ms,vs,_s,ys,bs,ws,xs,Ss,Ms,ks,Cs,Ts,Ds,zs,Ps,Es,Fs,Os,Ls,Is,Rs,As,Bs,Hs,Ns,Ws,js,Us,Vs,Gs,qs,Ys,Ks,Qs,Zs,$s,Xs,Js,tl,el,nl,il,rl,ol,al,sl,ll,cl,ul,hl,dl,fl,pl,gl,ml,vl,_l,yl,bl,wl,xl,Sl,Ml,kl,Cl,Tl,Dl,zl,Pl,El,Fl,Ol,Ll,Il,Rl,Al,Bl,Hl,Nl,Wl,jl,Ul,Vl,Gl,ql,Yl,Kl,Ql,Zl,$l,Xl,Jl,tc,ec,nc,ic,rc,oc,ac,sc,lc,cc,uc,hc,dc,fc,pc,gc,mc,vc,_c,yc,bc,wc,xc,Sc,Mc,kc,Cc,Tc,Dc,zc,Pc,Ec,Fc,Oc,Lc,Ic,Rc,Ac,Bc,Hc,Nc,Wc,jc,Uc,Vc,Gc,qc,Yc,Kc,Qc,Zc,$c,Xc,Jc,th,eh,nh,ih,rh,oh,ah,sh,lh,ch,uh,hh,dh,fh,ph,gh,mh,vh,_h,yh,bh,wh,xh,Sh,Mh,kh,Ch,Th,Dh,zh,Ph,Eh,Fh,Oh,Lh,Ih,Rh,Ah,Bh,Hh,Nh,Wh,jh,Uh,Vh,Gh,qh,Yh,Kh,Qh,Zh,$h,Xh,Jh,td,ed,nd,id,rd,od,ad,sd,ld,cd,ud,hd,dd,fd,pd,gd,md,vd,_d,yd,bd,wd,xd,Sd,Md,kd,Cd,Td,Dd,zd,Pd,Ed,Fd,Od,Ld,Id,Rd,Ad,Bd,Hd,Nd,Wd,jd,Ud,Vd,Gd,qd,Yd,Kd,Qd,Zd,$d,Xd,Jd,tt,et,nt,it,rt,ot,at,st,lt,ct,ut,ht,dt,ft,pt,gt,mt,vt,_t,yt,bt,wt,xt,St,Mt,kt,Ct,Tt,Dt,zt,Pt,Et,Ft,Ot,Lt,It,Rt,At,Bt,Ht,Nt,Wt,jt,Ut,Vt,Gt,qt,Yt,Kt,Qt,Zt,$t,Xt,Jt,te,ee,ne,ie,re,oe,ae,se,le,ce,ue,he,de,fe,pe,ge,me,ve,_e,ye,be,we,xe,Se,Me,ke,Ce,Te,De,ze,Pe,Ee,Fe,Oe,Le,Ie,Re,Ae,Be,He,Ne,We,je,Ue,Ve,Ge,qe,Ye,Ke,Qe,Ze,$e,Xe,Je,tn,en,nn,rn,on,an,sn,ln,cn,un,hn,dn,fn,pn,gn,mn,vn,_n,yn,bn,wn,xn,Sn,Mn,kn,Cn,Tn,Dn,zn,Pn,En,Fn,On,Ln,In,Rn,An,Bn,Hn,Nn,Wn,jn,Un,Vn,Gn,qn,Yn,Kn,Qn,Zn,$n,Xn,Jn,ti,ei,ni,ii,ri,oi,ai,si,li,ci,ui,hi,di,fi,pi,gi,mi,vi,_i,yi,bi,wi,xi,Si,Mi,ki,Ci,Ti,Di,zi,Pi,Ei,Fi,Oi,Li,Ii,Ri,Ai,Bi,Hi,Ni,Wi,ji,Ui,Vi,Gi,qi,Yi,Ki,Qi,Zi,$i,Xi,Ji,tr,er,nr,ir,rr,or,ar,sr,lr,cr,ur,hr,dr,fr,pr,gr,mr,vr,_r,yr,br,wr,xr,Sr,Mr,kr,Cr,Tr,Dr,zr,Pr,Er,Fr,Or,Lr,Ir,Rr,Ar,Br,Hr,Nr,Wr,jr,Ur,Vr,Gr,qr,Yr,Kr,Qr,Zr,$r,Xr,Jr,to,eo,no,io,ro,oo,ao,so,lo,co,uo,ho,do,fo,po,go,mo,vo,_o,yo,bo,wo,xo,So,Mo,ko,Co,To,Do,zo,Po,Eo,Fo,Oo,Lo,Io,Ro,Ao,Bo,Ho,No,Wo,jo,Uo,Vo,Go,qo,Yo,Ko,Qo,Zo,$o,Xo,Jo,ta,ea,na,ia,ra,oa,aa,sa,la,ca,ua,ha,da,fa,pa,ga,ma,va,_a,ya,ba,wa,xa,Sa,Ma,ka,Ca,Ta,Da,za,Pa,Ea,Fa,Oa,La,Ia,Ra,Aa,Ba,Ha,Na,Wa,ja,Ua,Va,Ga,qa,Ya,Ka,Qa,Za,$a,Xa,Ja,ts,es,ns,is,rs,os,as,ss,ls,cs,us,hs,ds,fs,ps,gs,ms,vs,_s,ys,bs,ws,xs,Ss,Ms,ks,Cs,Ts,Ds,zs,Ps,Es,Fs,Os,Ls,Is,Rs,As,Bs,Hs,Ns,Ws,js,Us,Vs,Gs,qs,Ys,Ks,Qs,Zs,$s,Xs,Js,tl,el,nl,il,rl,ol,al,sl,ll,cl,ul,hl,dl,fl,pl,gl,ml,vl,_l,yl,bl,wl,xl,Sl,Ml,kl,Cl,Tl,Dl,zl,Pl,El,Fl,Ol,Ll,Il,Rl,Al,Bl,Hl,Nl,Wl,jl,Ul,Vl,Gl,ql,Yl,Kl,Ql,Zl,$l,Xl,Jl,tc,ec,nc,ic,rc,oc,ac,sc,lc,cc,uc,hc,dc,fc,pc,gc,mc,vc,_c,yc,bc,wc,xc,Sc,Mc,kc,Cc,Tc,Dc,zc,Pc,Ec,Fc,Oc,Lc,Ic,Rc,Ac,Bc,Hc,Nc,Wc,jc,Uc,Vc,Gc,qc,Yc,Kc,Qc,Zc,$c,Xc,Jc,th,eh,nh,ih,rh,oh,ah,sh,lh,ch,uh,hh,dh,fh,ph,gh,mh,vh,_h,yh,bh,wh,xh,Sh,Mh,kh,Ch,Th,Dh,zh,Ph,Eh,Fh,Oh,Lh,Ih,Rh,Ah,Bh,Hh,Nh,Wh,jh,Uh,Vh,Gh,qh,Yh,Kh,Qh,Zh,$h,Xh,Jh,td,ed,nd,id,rd,od,ad,sd,ld,cd,ud,hd,dd,fd,pd,gd,md,vd,_d,yd,bd,wd,xd,Sd,Md,kd,Cd,Td,Dd,zd,Pd,Ed,Fd,Od,Ld,Id,Rd,Ad,Bd,Hd,Nd,Wd,jd,Ud,Vd,Gd,qd,Yd,Kd,Qd,Zd,$d,Xd,Jd,tt,et,nt,it,rt,ot,at,st,lt,ct,ut,ht,dt,ft,pt,gt,mt,vt,_t,yt,bt,wt,xt,St,Mt,kt,Ct,Tt,Dt,zt,Pt,Et,Ft,Ot,Lt,It,Rt,At,Bt,Ht,Nt,Wt,jt,Ut,Vt,Gt,qt,Yt,Kt,Qt,Zt,$t,Xt,Jt,te,ee,ne,ie,re,oe,ae,se,le,ce,ue,he,de,fe,pe,ge,me,ve,_e,ye,be,we,xe,Se,Me,ke,Ce,Te,De,ze,Pe,Ee,Fe,Oe,Le,Ie,Re,Ae,Be,He,Ne,We,je,Ue,Ve,Ge,qe,Ye,Ke,Qe,Ze,$e,Xe,Je,tn,en,nn,rn,on,an,sn,ln,cn,un,hn,dn,fn,pn,gn,mn,vn,_n,yn,bn,wn,xn,Sn,Mn,kn,Cn,Tn,Dn,zn,Pn,En,Fn,On,Ln,In,Rn,An,Bn,Hn,Nn,Wn,jn,Un,Vn,Gn,qn,Yn,Kn,Qn,Zn,$n,Xn,Jn,ti,ei,ni,ii,ri,oi,ai,si,li,ci,ui,hi,di,fi,pi,gi,mi,vi,_i,yi,bi,wi,xi,Si,Mi,ki,Ci,Ti,Di,zi,Pi,Ei,Fi,Oi,Li,Ii,Ri,Ai,Bi,Hi,Ni,Wi,ji,Ui,Vi,Gi,qi,Yi,Ki,Qi,Zi,$i,Xi,Ji,tr,er,nr,ir,rr,or,ar,sr,lr,cr,ur,hr,dr,fr,pr,gr,mr,vr,_r,yr,br,wr,xr,Sr,Mr,kr,Cr,Tr,Dr,zr,Pr,Er,Fr,Or,Lr,Ir,Rr,Ar,Br,Hr,Nr,Wr,jr,Ur,Vr,Gr,qr,Yr,Kr,Qr,Zr,$r,Xr,Jr,to,eo,no,io,ro,oo,ao,so,lo,co,uo,ho,do,fo,po,go,mo,vo,_o,yo,bo,wo,xo,So,Mo,ko,Co,To,Do,zo,Po,Eo,Fo,Oo,Lo,Io,Ro,Ao,Bo,Ho,No,Wo,jo,Uo,Vo,Go,qo,Yo,Ko,Qo,Zo,$o,Xo,Jo,ta,ea,na,ia,ra,oa,aa,sa,la,ca,ua,ha,da,fa,pa,ga,ma,va,_a,ya,ba,wa,xa,Sa,Ma,ka,Ca,Ta,Da,za,Pa,Ea,Fa,Oa,La,Ia,Ra,Aa,Ba,Ha,Na,Wa,ja,Ua,Va,Ga,qa,Ya,Ka,Qa,Za,$a,Xa,Ja,ts,es,ns,is,rs,os,as,ss,ls,cs,us,hs,ds,fs,ps,gs,ms,vs,_s,ys,bs,ws,xs,Ss,Ms,ks,Cs,Ts,Ds,zs,Ps,Es,Fs,Os,Ls,Is,Rs,As,Bs,Hs,Ns,Ws,js,Us,Vs,Gs,qs,Ys,Ks,Qs,Zs,$s,Xs,Js,tl,el,nl,il,rl,ol,al,sl,ll,cl,ul,hl,dl,fl,pl,gl,ml,vl,_l,yl,bl,wl,xl,Sl,Ml,kl,Cl,Tl,Dl,zl,Pl,El,Fl,Ol,Ll,Il,Rl,Al,Bl,Hl,Nl,Wl,jl,Ul,Vl,Gl,ql,Yl,Kl,Ql,Zl,$l,Xl,Jl,tc,ec,nc,ic,rc,oc,ac,sc,lc,cc,uc,hc,dc,fc,pc,gc,mc,vc,_c,yc,bc,wc,xc,Sc,Mc,kc,Cc,Tc,Dc,zc,Pc,Ec,Fc,Oc,Lc,Ic,Rc,Ac,Bc,Hc,Nc,Wc,jc,Uc,Vc,Gc,qc,Yc,Kc,Qc,Zc,$c,Xc,Jc,th,eh,nh,ih,rh,oh,ah,sh,lh,ch,uh,hh,dh,fh,ph,gh,mh,vh,_h,yh,bh,wh,xh,Sh,Mh,kh,Ch,Th,Dh,zh,Ph,Eh,Fh,Oh,Lh,Ih,Rh,Ah,Bh,Hh,Nh,Wh,jh,Uh,Vh,Gh,qh,Yh,Kh,Qh,Zh,$h,Xh,Jh,td,ed,nd,id,rd,od,ad,sd,ld,cd,ud,hd,dd,fd,pd,gd,md,vd,_d,yd,bd,wd,xd,Sd,Md,kd,Cd,Td,Dd,zd,Pd,Ed,Fd,Od,Ld,Id,Rd,Ad,Bd,Hd,Nd,Wd,jd,Ud,Vd,Gd,qd,Yd,Kd,Qd,Zd,$d,Xd,Jd;

        // Your chart code starts here
        document.addEventListener('DOMContentLoaded', async () => {
            if (typeof LightweightCharts === 'undefined') {
                console.error('Lightweight Charts not loaded - something went wrong with embedding');
                return;
            }
            console.log('Lightweight Charts version:', LightweightCharts.version());

            const container = document.getElementById('chart-container');
            const priceLabel = document.getElementById('price-label');
            const barInterval = 300; // 5 minutes
            let currentBar = null;
            let bars = [];

            try {
                const chart = LightweightCharts.createChart(container, {
                    width: window.innerWidth,
                    height: window.innerHeight,
                    layout: { background: { color: '#1E1E1E' }, textColor: '#D3D3D3' },
                    grid: { vertLines: { visible: false }, horzLines: { visible: false } },
                    timeScale: { timeVisible: true, secondsVisible: false },
                    rightPriceScale: { borderColor: '#2A2A2A' }
                });

                const barSeries = chart.addCandlestickSeries({
                    upColor: '#26a69a',
                    downColor: '#ef5350',
                    borderVisible: false,
                    wickUpColor: '#26a69a',
                    wickDownColor: '#ef5350'
                });

                const longLiqSeries = chart.addScatterSeries({ color: 'rgba(255, 0, 0, 0.7)', radius: 2 });
                const shortLiqSeries = chart.addScatterSeries({ color: 'rgba(0, 255, 0, 0.7)', radius: 2 });

                async function fetchHistoricalData() {
                    const limit = 300;
                    const response = await fetch(
                        `https://api.pro.coinbase.com/products/BTC-USD/candles?granularity=${barInterval}&limit=${limit}`
                    );
                    if (!response.ok) throw new Error(`Coinbase API failed: ${response.status}`);
                    const data = await response.json();
                    bars = data.reverse().map(([time, low, high, open, close]) => ({
                        time,
                        open,
                        high,
                        low,
                        close
                    }));
                    barSeries.setData(bars);
                    const lastBar = bars[bars.length - 1];
                    priceLabel.textContent = `$${lastBar.close.toFixed(2)}`;
                    chart.timeScale().fitContent();
                }

                const coinbaseWs = new WebSocket('wss://ws-feed.pro.coinbase.com');
                coinbaseWs.onopen = () => {
                    coinbaseWs.send(JSON.stringify({
                        type: 'subscribe',
                        product_ids: ['BTC-USD'],
                        channels: ['ticker']
                    }));
                };
                coinbaseWs.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    if (data.type !== 'ticker' || data.product_id !== 'BTC-USD') return;

                    const price = parseFloat(data.price);
                    const timestamp = Math.floor(Date.now() / 1000);
                    const barTime = Math.floor(timestamp / barInterval) * barInterval;

                    priceLabel.textContent = `$${price.toFixed(2)}`;

                    if (!currentBar || currentBar.time !== barTime) {
                        if (currentBar) barSeries.update(currentBar);
                        currentBar = { time: barTime, open: price, high: price, low: price, close: price };
                    } else {
                        currentBar.high = Math.max(currentBar.high, price);
                        currentBar.low = Math.min(currentBar.low, price);
                        currentBar.close = price;
                        barSeries.update(currentBar);
                    }
                };
                coinbaseWs.onerror = (error) => console.error('Coinbase WS error:', error);

                const bybitWs = new WebSocket('wss://stream.bybit.com/v5/public/linear');
                bybitWs.onopen = () => {
                    bybitWs.send(JSON.stringify({
                        op: 'subscribe',
                        args: ['liquidation.BTCUSDT']
                    }));
                };
                bybitWs.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    if (data.topic !== 'liquidation.BTCUSDT' || !data.data) return;

                    const { price, side } = data.data;
                    const timestamp = Math.floor(Date.now() / 1000);
                    const marker = { time: timestamp, value: parseFloat(price) };
                    (side === 'Buy' ? longLiqSeries : shortLiqSeries).update(marker);
                };
                bybitWs.onerror = (error) => console.error('Bybit WS error:', error);

                window.addEventListener('resize', () => chart.resize(window.innerWidth, window.innerHeight));
                window.addEventListener('unload', () => {
                    coinbaseWs.close();
                    bybitWs.close();
                });

                await fetchHistoricalData();
            } catch (error) {
                console.error('Chart setup error:', error);
            }
        });
    </script>
</body>
</html>

